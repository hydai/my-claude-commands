---
description: 執行實作計畫中的任務
allowed-tools: [Read, Write, MultiEdit, Bash, Grep, Task, TodoWrite, Edit, LS, Glob]
---

# Spec Driven Development - 執行實作階段

您已經啟動了 Spec Driven Development 的實作執行流程。

## 前置檢查與環境準備

### 1. 完整依賴檢查
我會檢查以下關鍵文件的存在性和完整性：
- `.claude/sdd/requirements.md` - 需求規格文件
- `.claude/sdd/design.md` - 架構設計文件
- `.claude/sdd/tasks.md` - 詳細任務計劃

如果任何文件缺失，我會提示執行對應的前置指令：
1. `/spec` - 分析需求並產生規格文件
2. `/design` - 基於需求進行架構設計
3. `/implement_plan` - 產生詳細實作計劃

### 2. 專案環境檢查
- 確認專案根目錄和結構
- 檢查開發環境和工具鏈配置
- 驗證依賴套件和版本兼容性
- 建立測試環境和相關配置

## 智能任務執行系統

### 階段 1：任務狀態全面分析
我會深度分析 `tasks.md` 中的所有任務：

#### 1.1 任務狀態分類
- ⏳ **待執行** (pending) - 可以開始的任務
- 🔄 **執行中** (in_progress) - 正在進行的任務
- ✅ **已完成** (completed) - 完成並驗收的任務
- ❌ **阻塞中** (blocked) - 遇到障礙的任務
- 🔁 **需重做** (rework) - 需要重新實作的任務
- ⚠️ **有風險** (at_risk) - 可能延期或有品質問題的任務

#### 1.2 依賴關係分析
- 解析任務間的技術依賴
- 識別可並行執行的任務群組
- 計算關鍵路徑和瓶頸任務
- 評估阻塞任務對整體進度的影響

#### 1.3 進度評估
- 計算整體完成百分比
- 評估預估時間與實際進度
- 識別進度風險和延期可能性
- 產生進度報告和建議

### 階段 2：智能執行策略

#### 2.1 執行優先順序
1. **緊急恢復**：優先處理阻塞任務和風險任務
2. **繼續進行**：完成已開始的執行中任務
3. **關鍵路徑**：執行影響整體進度的關鍵任務
4. **依賴優先**：優先執行被其他任務依賴的基礎任務
5. **並行機會**：識別可同時進行的獨立任務

#### 2.2 適應性執行
- 根據實際情況調整執行計劃
- 動態評估任務難度和時間需求
- 在遇到阻礙時自動尋找替代方案
- 保持與使用者的即時溝通和確認

### 階段 3：嚴格 BDD+TDD 執行流程

#### 3.1 Gherkin 場景分析階段 - BDD 行為定義
對於每個任務，我會：
- **場景解析**：分析任務對應的 Gherkin Feature 和 Scenario
- **行為理解**：深入理解業務行為和使用者期望
- **場景驗證**：確認場景的完整性和可執行性
- **背景設定**：理解 Background 和共用前置條件

#### 3.2 Step Definition 實作階段 - BDD 基礎建設
- **步驟定義**：將 Gherkin 步驟轉換為可執行代碼
- **測試環境準備**：建立 BDD 測試所需的基礎設施
- **資料準備**：設置測試資料和外部依賴 Mock
- **場景執行驗證**：確保 BDD 場景能正確執行（但應失敗）

#### 3.3 單元測試階段 - TDD 紅燈
- **分析驗收標準**：將任務的驗收標準轉換為具體測試案例
- **設計測試場景**：包含正向流程、異常情況、邊界條件
- **建立測試環境**：準備測試數據、Mock 物件、測試工具
- **編寫失敗測試**：確保測試在功能未實作時會失敗
- **驗證測試品質**：確保測試覆蓋率和測試意圖清晰

#### 3.4 功能實作階段 - TDD 綠燈
- **最小可行實作**：編寫剛好通過測試的最簡代碼
- **介面優先設計**：先定義清晰的模組介面
- **漸進式開發**：從核心功能開始，逐步擴展
- **持續驗證**：每次變更後立即執行測試
- **BDD 場景通過**：確保實作能通過所有相關 BDD 場景
- **集成測試**：確保新功能與現有系統兼容

#### 3.5 重構最佳化階段 - TDD 重構
- **代碼清理**：消除重複、改善命名、提高可讀性
- **架構優化**：應用設計模式、提高模組化程度
- **效能調優**：在測試保護下進行效能優化
- **文件更新**：更新代碼文件和使用說明
- **全面驗證**：執行完整測試套件確保品質
- **BDD 場景維護**：確保重構後所有 BDD 場景仍然通過

### 階段 4：進度管理與狀態同步

#### 4.1 即時狀態更新
- **任務開始**：將任務狀態更新為執行中，記錄開始時間
- **進度追蹤**：在 TDD 各階段更新詳細進度
- **阻塞記錄**：遇到問題時立即記錄阻塞原因和嘗試的解決方案
- **完成確認**：任務完成時進行全面驗收並更新狀態

#### 4.2 文件同步機制
- **tasks.md 更新**：每個任務狀態變更時立即更新文件
- **進度日誌**：記錄詳細的執行歷史和決策原因
- **品質檢查點**：在關鍵里程碑記錄品質評估結果
- **風險登記**：持續更新風險狀況和緩解措施

#### 4.3 使用者溝通
- **進度報告**：定期提供清晰的進度摘要
- **決策諮詢**：在需要技術或業務決策時主動諮詢
- **風險預警**：提前識別並報告潛在問題
- **完成慶祝**：在重要里程碑完成時給予正向反饋

### 階段 5：品質保證與持續改進

#### 5.1 BDD 場景驗證
- **場景執行**：執行所有相關的 Gherkin 場景
- **行為驗證**：確保實作符合業務需求和使用者期望
- **場景覆蓋率**：驗證所有定義的場景都能正確執行
- **業務規則檢查**：確保業務邏輯的正確實作

#### 5.2 代碼品質檢查
- **靜態分析**：執行 lint、type check 等品質工具
- **測試覆蓋率**：確保 BDD 場景和單元測試覆蓋率符合標準
- **效能基準**：驗證關鍵功能的效能指標
- **安全檢查**：掃描潛在的安全漏洞

#### 5.3 整合驗證
- **BDD 整合測試**：執行跨組件的 BDD 場景
- **功能測試**：執行端到端的功能驗證
- **回歸測試**：確保新功能沒有破壞現有功能和 BDD 場景
- **兼容性測試**：驗證跨平台和環境的兼容性
- **使用者驗收**：邀請使用者參與關鍵功能的驗收

### 階段 6：中斷恢復與異常處理

#### 6.1 中斷處理機制
- **狀態快照**：在任務執行過程中定期保存狀態
- **恢復檢查**：下次執行時檢查未完成的任務狀態
- **資料一致性**：確保中斷不會導致資料不一致
- **清理機制**：清理中斷時可能產生的臨時檔案

#### 6.2 錯誤處理策略
- **錯誤分類**：區分暫時性錯誤、系統錯誤、邏輯錯誤
- **自動重試**：對暫時性錯誤實施智能重試機制
- **降級方案**：在系統問題時提供替代執行方案
- **人工介入**：在自動處理無效時請求使用者協助

## 執行前確認流程

### 1. 執行計劃預覽
我會為您呈現：
- 待執行任務的摘要清單
- 預估的執行時間和資源需求
- 可能遇到的風險和挑戰
- 建議的執行順序和並行機會

### 2. 使用者確認選項
- **全量執行**：執行所有待執行任務
- **選擇性執行**：選擇特定任務或任務群組執行
- **試驗性執行**：先執行風險較低的任務進行驗證
- **恢復執行**：繼續之前中斷的執行進度

### 3. 執行模式設定
- **互動模式**：在每個關鍵決策點詢問使用者意見
- **自動模式**：根據既定策略自主執行，僅在異常時詢問
- **監督模式**：在每個任務完成後暫停等待確認

## 執行參數

$ARGUMENTS

---

## 開始執行

準備進行智能化的任務執行，我將：
1. 全面分析當前專案狀態和任務情況
2. 制定最佳的執行策略和順序
3. 嚴格遵循 TDD 流程確保代碼品質
4. 持續追蹤進度並與您保持溝通

讓我們開始分析任務狀況...

---

## 格式一致性確保

### 文件命名約定
- 需求文件：`requirements.md` 或 `requirement.md`
- 設計文件：`design.md`
- 任務文件：`tasks.md`
- 文件位置：`.claude/sdd/` 目錄下

### 狀態符號統一
在執行過程中，我會確保使用統一的任務狀態符號：
- `[x]` 已完成
- `[ ]` 待執行
- `[-]` 部分完成
- `[🔄]` 執行中（執行期間使用）
- `[❌]` 阻塞中（遇到問題時使用）

### 需求引用格式
- 中文文件：`_需求: 1.1, 2.1_`
- 英文文件：`_Requirements: 1.1, 2.1_`

### 文件更新原則
1. **即時同步**：任務狀態變更時立即更新 tasks.md
2. **格式保持**：維持原文件的語言風格（中文/英文）
3. **結構完整**：確保更新後的文件結構完整有效
4. **追蹤記錄**：在需要時記錄執行歷史和決策原因
